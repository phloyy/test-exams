import React, { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, RotateCcw, BookOpen, Trophy, AlertCircle, CheckCircle, XCircle, Save, SkipForward, ClipboardList, Filter } from 'lucide-react';

// Функция для перемешивания массива (Fisher-Yates)
const shuffleArray = (array) => {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
};

// Функция для получения детального пояснения
const getExplanation = (question, selectedAnswer, isCorrect) => {
  const correctAnswer = question.answers.find(a => a.correct);
  
  if (isCorrect) {
    if (question.explanation?.correct) {
      return question.explanation.correct;
    }
    return `Верно! ${correctAnswer.text}`;
  } else {
    let explanation = '';
    
    if (question.explanation?.details?.[selectedAnswer]) {
      explanation = question.explanation.details[selectedAnswer];
    } else {
      explanation = `Выбранный вариант неверен.`;
    }
    
    explanation += `\n\n✅ Правильный ответ: ${correctAnswer.text}`;
    
    if (question.explanation?.correct) {
      explanation += `\n\n${question.explanation.correct}`;
    }
    
    return explanation;
  }
};

const QUESTIONS_DATA = [{"id":1,"question":"1. Как называется матрица, у которой число строк равно числу столбцов?","answers":[{"text":"A)Прямоугольная","correct":false},{"text":"B) Квадратная","correct":true},{"text":"C) Диагональная","correct":false},{"text":"D) Единичная","correct":false}],"explanation":{"correct":"Квадратная матрица имеет одинаковое количество строк и столбцов (размер n×n). Только для квадратных матриц определены понятия определителя, следа, собственных значений.","details":{"A)Прямоугольная":"❌ Прямоугольная матрица имеет разное количество строк и столбцов (m×n, где m≠n). Для таких матриц нельзя вычислить определитель.","C) Диагональная":"❌ Диагональная матрица — квадратная матрица, у которой все элементы вне главной диагонали равны нулю. Диагональная матрица — частный случай квадратной.","D) Единичная":"❌ Единичная матрица E — диагональная матрица с единицами на главной диагонали. Произведение любой матрицы на единичную даёт исходную матрицу: A·E = E·A = A."}}},{"id":2,"question":"2. Что означает запись B=αA?","answers":[{"text":"A) Сумма матриц","correct":false},{"text":"B) Произведение матрицы на число","correct":true},{"text":"C) Транспонирование","correct":false},{"text":"D) Умножение матриц","correct":false}],"explanation":{"correct":"Умножение матрицы на число α означает умножение каждого элемента на это число: (αA)ij = α·aij. Все свойства линейности сохраняются.","details":{"A) Сумма матриц":"❌ Суммой матриц A+B называется матрица, элементы которой равны сумме соответствующих элементов: (A+B)ij = aij + bij. Складывать можно только матрицы одинакового размера.","C) Транспонирование":"❌ Транспонирование AT — операция замены строк на столбцы: (AT)ij = aji. Дважды транспонированная матрица равна исходной: (AT)T = A.","D) Умножение матриц":"❌ Произведение C=AB определяется как cij = Σ(aik·bkj). Важно: AB ≠ BA в общем случае (умножение некоммутативно)."}}},{"id":3,"question":"3. Как называется матрица, у которой все элементы равны нулю?","answers":[{"text":"A) Единичная","correct":false},{"text":"B) Диагональная","correct":false},{"text":"C) Нулевая","correct":true},{"text":"D) Симметричная","correct":false}],"explanation":{"correct":"Нулевая матрица O состоит из одних нулей. Является нейтральным элементом для сложения: A + O = A. При умножении на неё получается нулевая матрица.","details":{"A) Единичная":"❌ Единичная матрица E — диагональная матрица с единицами на главной диагонали. Произведение любой матрицы на единичную даёт исходную матрицу: A·E = E·A = A.","B) Диагональная":"❌ Диагональная матрица — квадратная матрица, у которой все элементы вне главной диагонали равны нулю. Диагональная матрица — частный случай квадратной.","D) Симметричная":"❌ Симметричная матрица равна своей транспонированной: A = Aᵀ, т.е. aij = aji. Все собственные значения симметричной матрицы вещественны."}}},{"id":4,"question":"4. Что такое след матрицы?","answers":[{"text":"A) Сумма всех элементов","correct":false},{"text":"B) Сумма диагональных элементов","correct":true},{"text":"C) Произведение диагональных элементов","correct":false},{"text":"D) Сумма элементов первой строки","correct":false}],"explanation":{"correct":"Правильный ответ: Сумма диагональных элементов","details":{"A) Сумма всех элементов":"❌ Сумма всех элементов — неверный вариант в контексте данного вопроса.","C) Произведение диагональных элементов":"❌ Произведение диагональных элементов — неверный вариант в контексте данного вопроса.","D) Сумма элементов первой строки":"❌ Сумма элементов первой строки — неверный вариант в контексте данного вопроса."}}},{"id":5,"question":"5. Как обозначается транспонированная матрица?","answers":[{"text":"A) A^-\n ","correct":false},{"text":"B) A^H","correct":false},{"text":"C) A^T","correct":true},{"text":"D) A^(-1)","correct":false}],"explanation":{"correct":"Правильный ответ: A^T","details":{"A) A^-\n ":"❌ A^- — неверный вариант в контексте данного вопроса.","B) A^H":"❌ A^H — неверный вариант в контексте данного вопроса.","D) A^(-1)":"❌ A^(-1) — неверный вариант в контексте данного вопроса."}}},{"id":6,"question":"6. Чему равно произведение: 1-матрица (1 2) строчная, 2-матрица (3 4) столбичная","answers":[{"text":"A) (3,8)-строчная","correct":false},{"text":"B) (11)","correct":true},{"text":"C) (3,8)-столбичная","correct":false},{"text":"D) 1-строк ( 1 2), 2-строк (3 4)","correct":false}],"explanation":{"correct":"Правильный ответ: (11)","details":{"A) (3,8)-строчная":"❌ (3,8)-строчная — неверный вариант в контексте данного вопроса.","C) (3,8)-столбичная":"❌ (3,8)-столбичная — неверный вариант в контексте данного вопроса.","D) 1-строк ( 1 2), 2-строк (3 4)":"❌ 1-строк ( 1 2), 2-строк (3 4) — неверный вариант в контексте данного вопроса."}}},{"id":7,"question":"7. Что такое коммутатор матриц  A и B?","answers":[{"text":"A) AB","correct":false},{"text":"B) A+B","correct":false},{"text":"C) AB-BA","correct":true},{"text":"D) (AB+BA)/2","correct":false}],"explanation":{"correct":"Правильный ответ: AB-BA","details":{"A) AB":"❌ AB — неверный вариант в контексте данного вопроса.","B) A+B":"❌ A+B — неверный вариант в контексте данного вопроса.","D) (AB+BA)/2":"❌ (AB+BA)/2 — неверный вариант в контексте данного вопроса."}}},{"id":8,"question":"8. Какая из следующих операций является элементарным преобразованием матрицы?","answers":[{"text":"A) Возведение в степень","correct":false},{"text":"B) Умножение строки на ненулевое число","correct":true},{"text":"C) Транспонирование","correct":false},{"text":"D) Вычисление следа","correct":false}],"explanation":{"correct":"Правильный ответ: Умножение строки на ненулевое число","details":{"A) Возведение в степень":"❌ Возведение в степень — неверный вариант в контексте данного вопроса.","C) Транспонирование":"❌ Транспонирование AT — операция замены строк на столбцы: (AT)ij = aji. Дважды транспонированная матрица равна исходной: (AT)T = A.","D) Вычисление следа":"❌ Вычисление следа — неверный вариант в контексте данного вопроса."}}},{"id":9,"question":"9. Что такое определитель (детерминант) матрицы?","answers":[{"text":"A)Сумма всех элементов матрицы","correct":false},{"text":"B) Число, вычисляемое по формуле с перестановками элементов","correct":true},{"text":"C) Произведение диагональных элементов","correct":false},{"text":"D) Максимальный элемент матрицы","correct":false}],"explanation":{"correct":"Правильный ответ: Число, вычисляемое по формуле с перестановками элементов","details":{"A)Сумма всех элементов матрицы":"❌ Сумма всех элементов матрицы — неверный вариант в контексте данного вопроса.","C) Произведение диагональных элементов":"❌ Произведение диагональных элементов — неверный вариант в контексте данного вопроса.","D) Максимальный элемент матрицы":"❌ Максимальный элемент матрицы — неверный вариант в контексте данного вопроса."}}},{"id":10,"question":"10. Как обозначается определитель матрицы A?","answers":[{"text":"A) tr(A)","correct":false},{"text":"B) adj(A)","correct":false},{"text":"C) det(A)","correct":true},{"text":"D) rank(A)","correct":false}],"explanation":{"correct":"Правильный ответ: det(A)","details":{"A) tr(A)":"❌ tr(A) — неверный вариант в контексте данного вопроса.","B) adj(A)":"❌ adj(A) — неверный вариант в контексте данного вопроса.","D) rank(A)":"❌ rank(A) — неверный вариант в контексте данного вопроса."}}},{"id":11,"question":"11. Сколько слагаемых в определителе матрицы 4-го порядка?","answers":[{"text":"A) 16","correct":false},{"text":"B) 24","correct":true},{"text":"C) 32","correct":false},{"text":"D) 8","correct":false}],"explanation":{"correct":"Правильный ответ: 24","details":{"A) 16":"❌ 16 — неверный вариант в контексте данного вопроса.","C) 32":"❌ 32 — неверный вариант в контексте данного вопроса.","D) 8":"❌ 8 — неверный вариант в контексте данного вопроса."}}},{"id":12,"question":"12. Что такое минор элемента матрицы?","answers":[{"text":"A) Сумма элементов строки","correct":false},{"text":"B) Определитель матрицы, полученной вычёркиванием строки и столбца","correct":true},{"text":"C) Алгебраическое дополнение","correct":false},{"text":"D) Произведение диагональных элементов","correct":false}],"explanation":{"correct":"Правильный ответ: Определитель матрицы, полученной вычёркиванием строки и столбца","details":{"A) Сумма элементов строки":"❌ Сумма элементов строки — неверный вариант в контексте данного вопроса.","C) Алгебраическое дополнение":"❌ Алгебраическое дополнение — неверный вариант в контексте данного вопроса.","D) Произведение диагональных элементов":"❌ Произведение диагональных элементов — неверный вариант в контексте данного вопроса."}}},{"id":13,"question":"13. Как связано алгебраическое дополнение и минор?","answers":[{"text":"A) A_{ij}=M_{ij}\n ","correct":false},{"text":"B) A_{ij}=(-1)^(i+j)*M_{ij}","correct":true},{"text":"C) A_{ij}=(-1)^(i-j)*M_{ij}","correct":false},{"text":"D) A_{ij}=1/M_{ij}","correct":false}],"explanation":{"correct":"Правильный ответ: A_{ij}=(-1)^(i+j)*M_{ij}","details":{"A) A_{ij}=M_{ij}\n ":"❌ A_{ij}=M_{ij} — неверный вариант в контексте данного вопроса.","C) A_{ij}=(-1)^(i-j)*M_{ij}":"❌ A_{ij}=(-1)^(i-j)*M_{ij} — неверный вариант в контексте данного вопроса.","D) A_{ij}=1/M_{ij}":"❌ A_{ij}=1/M_{ij} — неверный вариант в контексте данного вопроса."}}},{"id":14,"question":"14. Если в матрице есть две одинаковые строки, то её определитель:","answers":[{"text":"A) Удваивается","correct":false},{"text":"B) Меняет знак","correct":false},{"text":"C) Равен 0","correct":true},{"text":"D) Равен 1","correct":false}],"explanation":{"correct":"Правильный ответ: Равен 0","details":{"A) Удваивается":"❌ Удваивается — неверный вариант в контексте данного вопроса.","B) Меняет знак":"❌ Меняет знак — неверный вариант в контексте данного вопроса.","D) Равен 1":"❌ Равен 1 — неверный вариант в контексте данного вопроса."}}},{"id":15,"question":"15. Что происходит с определителем, если поменять местами две строки?","answers":[{"text":"A) Он не меняется","correct":false},{"text":"B) Он умножается на -1","correct":true},{"text":"C) Он умножается на 2","correct":false},{"text":"D) Он становится равным 0","correct":false}],"explanation":{"correct":"Правильный ответ: Он умножается на -1","details":{"A) Он не меняется":"❌ Он не меняется — неверный вариант в контексте данного вопроса.","C) Он умножается на 2":"❌ Он умножается на 2 — неверный вариант в контексте данного вопроса.","D) Он становится равным 0":"❌ Он становится равным 0 — неверный вариант в контексте данного вопроса."}}},{"id":16,"question":"16. Как называется правило, упрощающее запоминание формулы для определителя 3-го порядка?","answers":[{"text":"A) Правило Саррюса","correct":false},{"text":"B) Правило Крамера","correct":false},{"text":"C) Правило треугольников","correct":true},{"text":"D) Правило Лапласа","correct":false}],"explanation":{"correct":"Правильный ответ: Правило треугольников","details":{"A) Правило Саррюса":"❌ Правило Саррюса — неверный вариант в контексте данного вопроса.","B) Правило Крамера":"❌ Правило Крамера — неверный вариант в контексте данного вопроса.","D) Правило Лапласа":"❌ Правило Лапласа — неверный вариант в контексте данного вопроса."}}},{"id":17,"question":"17. Если все элементы строки умножить на число λ, то определитель:","answers":[{"text":"A) Не изменится","correct":false},{"text":"B) Умножится на λ","correct":true},{"text":"C) Разделится на λ","correct":false},{"text":"D) Умножится на λ²","correct":false}],"explanation":{"correct":"Правильный ответ: Умножится на λ","details":{"A) Не изменится":"❌ Не изменится — неверный вариант в контексте данного вопроса.","C) Разделится на λ":"❌ Разделится на λ — неверный вариант в контексте данного вопроса.","D) Умножится на λ²":"❌ Умножится на λ² — неверный вариант в контексте данного вопроса."}}},{"id":18,"question":"18. Что означает, что матрица A является невырожденной?","answers":[{"text":"A)Её определитель равен нулю","correct":false},{"text":"B) Она имеет обратную матрицу","correct":false},{"text":"C) Её определитель не равен нулю","correct":true},{"text":"D) Она является единичной матрицей","correct":false}],"explanation":{"correct":"Правильный ответ: Её определитель не равен нулю","details":{"A)Её определитель равен нулю":"❌ Её определитель равен нулю — неверный вариант в контексте данного вопроса.","B) Она имеет обратную матрицу":"❌ Она имеет обратную матрицу — неверный вариант в контексте данного вопроса.","D) Она является единичной матрицей":"❌ Она является единичной матрицей — неверный вариант в контексте данного вопроса."}}},{"id":19,"question":"19.  Как обозначается обратная матрица для матрицы A?","answers":[{"text":"A) A^∗","correct":false},{"text":"B) A^(−1) ","correct":true},{"text":"C) A^T","correct":false},{"text":"D) A^+","correct":false}],"explanation":{"correct":"Правильный ответ: A^(−1)","details":{"A) A^∗":"❌ A^∗ — неверный вариант в контексте данного вопроса.","C) A^T":"❌ A^T — неверный вариант в контексте данного вопроса.","D) A^+":"❌ A^+ — неверный вариант в контексте данного вопроса."}}},{"id":20,"question":"20. Что такое присоединённая (союзная) матрица?","answers":[{"text":"A)Матрица, составленная из алгебраических дополнений элементов исходной матрицы","correct":true},{"text":"B) Транспонированная матрица","correct":false},{"text":"C) Матрица, обратная к исходной","correct":false},{"text":"D) Матрица, полученная заменой каждого элемента на его минор","correct":false}],"explanation":{"correct":"Правильный ответ: Матрица, составленная из алгебраических дополнений элементов исходной матрицы","details":{"B) Транспонированная матрица":"❌ Транспонированная матрица — неверный вариант в контексте данного вопроса.","C) Матрица, обратная к исходной":"❌ Матрица, обратная к исходной — неверный вариант в контексте данного вопроса.","D) Матрица, полученная заменой каждого элемента на его минор":"❌ Матрица, полученная заменой каждого элемента на его минор — неверный вариант в контексте данного вопроса."}}},{"id":21,"question":"21. Векторы называются линейно независимыми, если…","answers":[{"text":"A) Их линейная комбинация равна нулю только при всех нулевых коэффициентах","correct":true},{"text":"B) Хотя бы один из них равен нулю","correct":false},{"text":"C) Они пропорциональны","correct":false},{"text":"D) Их сумма равна нулю","correct":false}],"explanation":{"correct":"Правильный ответ: Их линейная комбинация равна нулю только при всех нулевых коэффициентах","details":{"B) Хотя бы один из них равен нулю":"❌ Хотя бы один из них равен нулю — неверный вариант в контексте данного вопроса.","C) Они пропорциональны":"❌ Они пропорциональны — неверный вариант в контексте данного вопроса.","D) Их сумма равна нулю":"❌ Их сумма равна нулю — неверный вариант в контексте данного вопроса."}}},{"id":22,"question":"22. Что такое ранг матрицы?","answers":[{"text":"A) Количество её строк ","correct":false},{"text":"B) Наибольший порядок её ненулевого минора","correct":true},{"text":"C) Сумма её элементов","correct":false},{"text":"D) Количество её столбцов","correct":false}],"explanation":{"correct":"Правильный ответ: Наибольший порядок её ненулевого минора","details":{"A) Количество её строк ":"❌ Количество её строк — неверный вариант в контексте данного вопроса.","C) Сумма её элементов":"❌ Сумма её элементов — неверный вариант в контексте данного вопроса.","D) Количество её столбцов":"❌ Количество её столбцов — неверный вариант в контексте данного вопроса."}}},{"id":23,"question":"23. Какое преобразование НЕ меняет ранг матрицы?","answers":[{"text":"A) Умножение строки на 0","correct":false},{"text":"B) Перестановка строк","correct":false},{"text":"C) Удаление строки","correct":false},{"text":"D) Прибавление к одной строке другой, умноженной на число","correct":true}],"explanation":{"correct":"Правильный ответ: Прибавление к одной строке другой, умноженной на число","details":{"A) Умножение строки на 0":"❌ Умножение строки на 0 — неверный вариант в контексте данного вопроса.","B) Перестановка строк":"❌ Перестановка строк — неверный вариант в контексте данного вопроса.","C) Удаление строки":"❌ Удаление строки — неверный вариант в контексте данного вопроса."}}},{"id":24,"question":"24. Как называется минор, который получается из данного добавлением одной строки и одного столбца?","answers":[{"text":"A) Базисный","correct":false},{"text":"B) Окаймляющий","correct":true},{"text":"C)  Главный","correct":false},{"text":"D) Диагональный","correct":false}],"explanation":{"correct":"Правильный ответ: Окаймляющий","details":{"A) Базисный":"❌ Базисный — неверный вариант в контексте данного вопроса.","C)  Главный":"❌ Главный — неверный вариант в контексте данного вопроса.","D) Диагональный":"❌ Диагональный — неверный вариант в контексте данного вопроса."}}},{"id":25,"question":"25. Если все окаймляющие миноры для минора M_k равны нулю, то ранг матрицы равен…","answers":[{"text":"A) k+1","correct":false},{"text":"B) k","correct":true},{"text":"C) 1","correct":false},{"text":"D) 0","correct":false}],"explanation":{"correct":"Правильный ответ: k","details":{"A) k+1":"❌ k+1 — неверный вариант в контексте данного вопроса.","C) 1":"❌ 1 — неверный вариант в контексте данного вопроса.","D) 0":"❌ 0 — неверный вариант в контексте данного вопроса."}}},{"id":26,"question":"26. Какой метод нахождения ранга наиболее эффективен для матриц большой размерности?","answers":[{"text":"A) Метод перебора всех миноров","correct":false},{"text":"B) Метод окаймляющих миноров","correct":false},{"text":"C) Метод элементарных преобразований (метод Гаусса)","correct":true},{"text":"D) Метод скелетного разложения","correct":false}],"explanation":{"correct":"Правильный ответ: Метод элементарных преобразований (метод Гаусса)","details":{"A) Метод перебора всех миноров":"❌ Метод перебора всех миноров — неверный вариант в контексте данного вопроса.","B) Метод окаймляющих миноров":"❌ Метод окаймляющих миноров — неверный вариант в контексте данного вопроса.","D) Метод скелетного разложения":"❌ Метод скелетного разложения — неверный вариант в контексте данного вопроса."}}},{"id":27,"question":"27.  Что называется решением системы линейных уравнений?","answers":[{"text":"A)Матрица коэффициентов системы","correct":false},{"text":"B) Совокупность значений неизвестных, обращающих все уравнения в тождества","correct":true},{"text":"C) Результат элементарных преобразований","correct":false},{"text":"D) Свободные члены системы","correct":false}],"explanation":{"correct":"Правильный ответ: Совокупность значений неизвестных, обращающих все уравнения в тождества","details":{"A)Матрица коэффициентов системы":"❌ Матрица коэффициентов системы — неверный вариант в контексте данного вопроса.","C) Результат элементарных преобразований":"❌ Результат элементарных преобразований — неверный вариант в контексте данного вопроса.","D) Свободные члены системы":"❌ Свободные члены системы — неверный вариант в контексте данного вопроса."}}},{"id":28,"question":"28.  Какая система называется совместной?","answers":[{"text":"A) Та, которая имеет единственное решение","correct":false},{"text":"B) Та, которая не имеет решений","correct":false},{"text":"C) Та, которая имеет хотя бы одно решение","correct":true},{"text":"D) Та, которая имеет бесконечно много решений","correct":false}],"explanation":{"correct":"Правильный ответ: Та, которая имеет хотя бы одно решение","details":{"A) Та, которая имеет единственное решение":"❌ Та, которая имеет единственное решение — неверный вариант в контексте данного вопроса.","B) Та, которая не имеет решений":"❌ Та, которая не имеет решений — неверный вариант в контексте данного вопроса.","D) Та, которая имеет бесконечно много решений":"❌ Та, которая имеет бесконечно много решений — неверный вариант в контексте данного вопроса."}}},{"id":29,"question":"29. Какое преобразование НЕ является элементарным?","answers":[{"text":"A)Перестановка двух уравнений","correct":false},{"text":"B) Умножение уравнения на ноль","correct":true},{"text":"C) Прибавление к одному уравнению другого, умноженного на число","correct":false},{"text":"D) Умножение уравнения на ненулевой элемент поля","correct":false}],"explanation":{"correct":"Правильный ответ: Умножение уравнения на ноль","details":{"A)Перестановка двух уравнений":"❌ Перестановка двух уравнений — неверный вариант в контексте данного вопроса.","C) Прибавление к одному уравнению другого, умноженного на число":"❌ Прибавление к одному уравнению другого, умноженного на число — неверный вариант в контексте данного вопроса.","D) Умножение уравнения на ненулевой элемент поля":"❌ Умножение уравнения на ненулевой элемент поля — неверный вариант в контексте данного вопроса."}}},{"id":30,"question":"30. Как называется система, не имеющая решений?","answers":[{"text":"A) Определённая","correct":false},{"text":"B) Неопределённая","correct":false},{"text":"C) Совместная","correct":false},{"text":"D) Несовместная","correct":true}],"explanation":{"correct":"Правильный ответ: Несовместная","details":{"A) Определённая":"❌ Определённая — неверный вариант в контексте данного вопроса.","B) Неопределённая":"❌ Неопределённая — неверный вариант в контексте данного вопроса.","C) Совместная":"❌ Совместная — неверный вариант в контексте данного вопроса."}}},{"id":31,"question":"31. Что означает эквивалентность двух систем?","answers":[{"text":"A) Они имеют одинаковое число уравнений","correct":false},{"text":"B) Они имеют одинаковые решения","correct":true},{"text":"C) Они записаны в одном и том же поле","correct":false},{"text":"D) Они имеют одинаковые свободные члены","correct":false}],"explanation":{"correct":"Правильный ответ: Они имеют одинаковые решения","details":{"A) Они имеют одинаковое число уравнений":"❌ Они имеют одинаковое число уравнений — неверный вариант в контексте данного вопроса.","C) Они записаны в одном и том же поле":"❌ Они записаны в одном и том же поле — неверный вариант в контексте данного вопроса.","D) Они имеют одинаковые свободные члены":"❌ Они имеют одинаковые свободные члены — неверный вариант в контексте данного вопроса."}}},{"id":32,"question":"32. Какой вид имеет система после применения метода Гаусса, если она совместна и определена?","answers":[{"text":"A) Ступенчатая с свободными переменными","correct":false},{"text":"B) Треугольная с единственным решением","correct":true},{"text":"C) Содержит уравнение 0 = 1","correct":false},{"text":"D) Все коэффициенты равны нулю","correct":false}],"explanation":{"correct":"Правильный ответ: Треугольная с единственным решением","details":{"A) Ступенчатая с свободными переменными":"❌ Ступенчатая с свободными переменными — неверный вариант в контексте данного вопроса.","C) Содержит уравнение 0 = 1":"❌ Содержит уравнение 0 = 1 — неверный вариант в контексте данного вопроса.","D) Все коэффициенты равны нулю":"❌ Все коэффициенты равны нулю — неверный вариант в контексте данного вопроса."}}},{"id":33,"question":"33. Что означает уравнение вида 0 = 1 в процессе преобразований?","answers":[{"text":"A) Система неопределённа","correct":false},{"text":"B) Система имеет единственное решение","correct":false},{"text":"C) Система несовместна","correct":true},{"text":"D) Система эквивалентна другой системе","correct":false}],"explanation":{"correct":"Правильный ответ: Система несовместна","details":{"A) Система неопределённа":"❌ Система неопределённа — неверный вариант в контексте данного вопроса.","B) Система имеет единственное решение":"❌ Система имеет единственное решение — неверный вариант в контексте данного вопроса.","D) Система эквивалентна другой системе":"❌ Система эквивалентна другой системе — неверный вариант в контексте данного вопроса."}}},{"id":34,"question":"34. Как называются переменные, которым можно придавать произвольные значения в общем решении?","answers":[{"text":"A) Главные","correct":false},{"text":"B) Зависимые","correct":false},{"text":"C)  Свободные","correct":true},{"text":"D) Базовые","correct":false}],"explanation":{"correct":"Правильный ответ: Свободные","details":{"A) Главные":"❌ Главные — неверный вариант в контексте данного вопроса.","B) Зависимые":"❌ Зависимые — неверный вариант в контексте данного вопроса.","D) Базовые":"❌ Базовые — неверный вариант в контексте данного вопроса."}}},{"id":35,"question":"35. Какой шаг метода Гаусса выполнен в примере 1 после первого преобразования матрицы?","answers":[{"text":"A) Перестановка строк","correct":false},{"text":"B) Умножение строки на число","correct":false},{"text":"C) Вычитание первой строки из остальных","correct":true},{"text":"D) Деление строки на число","correct":false}],"explanation":{"correct":"Правильный ответ: Вычитание первой строки из остальных","details":{"A) Перестановка строк":"❌ Перестановка строк — неверный вариант в контексте данного вопроса.","B) Умножение строки на число":"❌ Умножение строки на число — неверный вариант в контексте данного вопроса.","D) Деление строки на число":"❌ Деление строки на число — неверный вариант в контексте данного вопроса."}}},{"id":36,"question":"36.  Если определитель матрицы равен нулю, то:","answers":[{"text":"A) Обратная матрица равна единичной","correct":false},{"text":"B) Обратная матрица равна нулевой","correct":false},{"text":"C) Обратная матрица не существует","correct":true},{"text":"D) Обратная матрица равна транспонированной","correct":false}],"explanation":{"correct":"Правильный ответ: Обратная матрица не существует","details":{"A) Обратная матрица равна единичной":"❌ Обратная матрица равна единичной — неверный вариант в контексте данного вопроса.","B) Обратная матрица равна нулевой":"❌ Обратная матрица равна нулевой — неверный вариант в контексте данного вопроса.","D) Обратная матрица равна транспонированной":"❌ Обратная матрица равна транспонированной — неверный вариант в контексте данного вопроса."}}},{"id":37,"question":"37. Что получится в результате умножения матрицы на её обратную?","answers":[{"text":"A)Нулевая матрица","correct":false},{"text":"B) Единичная матрица","correct":true},{"text":"C) Транспонированная матрица","correct":false},{"text":"D) Матрица алгебраических дополнений","correct":false}],"explanation":{"correct":"Правильный ответ: Единичная матрица","details":{"A)Нулевая матрица":"❌ Нулевая матрица — неверный вариант в контексте данного вопроса.","C) Транспонированная матрица":"❌ Транспонированная матрица — неверный вариант в контексте данного вопроса.","D) Матрица алгебраических дополнений":"❌ Матрица алгебраических дополнений — неверный вариант в контексте данного вопроса."}}},{"id":38,"question":"38. Матрица алгебраических дополнений получается из матрицы миноров путем:","answers":[{"text":"A) Транспонирования","correct":false},{"text":"B)  Умножения на определитель","correct":false},{"text":"C) Смены знаков у элементов с нечетной суммой индексов","correct":true},{"text":"D) Деления на определитель","correct":false}],"explanation":{"correct":"Правильный ответ: Смены знаков у элементов с нечетной суммой индексов","details":{"A) Транспонирования":"❌ Транспонирования — неверный вариант в контексте данного вопроса.","B)  Умножения на определитель":"❌ Умножения на определитель — неверный вариант в контексте данного вопроса.","D) Деления на определитель":"❌ Деления на определитель — неверный вариант в контексте данного вопроса."}}},{"id":39,"question":"39. Как записывается система линейных уравнений в матричной форме?","answers":[{"text":"A) AX=b ","correct":true},{"text":"B) X=Ab","correct":false},{"text":"C) A=Xb","correct":false},{"text":"D) b=AX","correct":false}],"explanation":{"correct":"Правильный ответ: AX=b","details":{"B) X=Ab":"❌ X=Ab — неверный вариант в контексте данного вопроса.","C) A=Xb":"❌ A=Xb — неверный вариант в контексте данного вопроса.","D) b=AX":"❌ b=AX — неверный вариант в контексте данного вопроса."}}},{"id":40,"question":"40. Если в системе уравнений отсутствует переменная, то в матрице А:","answers":[{"text":"A) Ставится единица","correct":false},{"text":"B) Ставится число 2","correct":false},{"text":"C) Ставится ноль","correct":true},{"text":"D) Строка пропускается","correct":false}],"explanation":{"correct":"Правильный ответ: Ставится ноль","details":{"A) Ставится единица":"❌ Ставится единица — неверный вариант в контексте данного вопроса.","B) Ставится число 2":"❌ Ставится число 2 — неверный вариант в контексте данного вопроса.","D) Строка пропускается":"❌ Строка пропускается — неверный вариант в контексте данного вопроса."}}},{"id":41,"question":"41. Как называется матрица, у которой на главной диагонали единицы, а остальные элементы нули?","answers":[{"text":"A) Обратная","correct":false},{"text":"B) Транспонированная","correct":false},{"text":"C)  Единичная","correct":true},{"text":"D) Алгебраических дополнений","correct":false}],"explanation":{"correct":"Единичная матрица E — диагональная матрица с единицами на главной диагонали. Произведение любой матрицы на единичную даёт исходную матрицу: A·E = E·A = A.","details":{"A) Обратная":"❌ Обратная — неверный вариант в контексте данного вопроса.","B) Транспонированная":"❌ Транспонированная — неверный вариант в контексте данного вопроса.","D) Алгебраических дополнений":"❌ Алгебраических дополнений — неверный вариант в контексте данного вопроса."}}},{"id":42,"question":"42. Что такое M_{23} ?","answers":[{"text":"A)Элемент во 2 строке и 3 столбце","correct":false},{"text":"B) Минор элемента во 2 строке и 3 столбце","correct":true},{"text":"C) Алгебраическое дополнение элемента в 3 строке и 2 столбце","correct":false},{"text":"D)Определитель всей матрицы","correct":false}],"explanation":{"correct":"Правильный ответ: Минор элемента во 2 строке и 3 столбце","details":{"A)Элемент во 2 строке и 3 столбце":"❌ Элемент во 2 строке и 3 столбце — неверный вариант в контексте данного вопроса.","C) Алгебраическое дополнение элемента в 3 строке и 2 столбце":"❌ Алгебраическое дополнение элемента в 3 строке и 2 столбце — неверный вариант в контексте данного вопроса.","D)Определитель всей матрицы":"❌ Определитель всей матрицы — неверный вариант в контексте данного вопроса."}}},{"id":43,"question":"43. При вычислении обратной матрицы для матрицы 3×3 необходимо найти:","answers":[{"text":"A) 6 миноров","correct":false},{"text":"B) 8 миноров","correct":false},{"text":"C) 9 миноров","correct":true},{"text":"D) 12 миноров","correct":false}],"explanation":{"correct":"Правильный ответ: 9 миноров","details":{"A) 6 миноров":"❌ 6 миноров — неверный вариант в контексте данного вопроса.","B) 8 миноров":"❌ 8 миноров — неверный вариант в контексте данного вопроса.","D) 12 миноров":"❌ 12 миноров — неверный вариант в контексте данного вопроса."}}},{"id":44,"question":"44. Расстояние между точками M₁(2, 3) и M₂(5, 7) на плоскости равно:","answers":[{"text":"A) 3","correct":false},{"text":"B) 4","correct":false},{"text":"C) 5","correct":true},{"text":"D) 6","correct":false}],"explanation":{"correct":"Правильный ответ: 5","details":{"A) 3":"❌ 3 — неверный вариант в контексте данного вопроса.","B) 4":"❌ 4 — неверный вариант в контексте данного вопроса.","D) 6":"❌ 6 — неверный вариант в контексте данного вопроса."}}},{"id":45,"question":"45.  Если точка M делит отрезок M₁M₂ в отношении λ = 1, то она находится:","answers":[{"text":"A) ближе к M₁","correct":false},{"text":"B) ближе к M₂","correct":false},{"text":"C) в середине отрезка","correct":true},{"text":"D) вне отрезка","correct":false}],"explanation":{"correct":"Правильный ответ: в середине отрезка","details":{"A) ближе к M₁":"❌ ближе к M₁ — неверный вариант в контексте данного вопроса.","B) ближе к M₂":"❌ ближе к M₂ — неверный вариант в контексте данного вопроса.","D) вне отрезка":"❌ вне отрезка — неверный вариант в контексте данного вопроса."}}},{"id":46,"question":"46. Величина направленного отрезка →AB  на оси определяется как:","answers":[{"text":"A)длина AB","correct":false},{"text":"B) длина AB со знаком в зависимости от направления","correct":true},{"text":"C) всегда положительна","correct":false},{"text":"D) произведение координат","correct":false}],"explanation":{"correct":"Правильный ответ: длина AB со знаком в зависимости от направления","details":{"A)длина AB":"❌ длина AB — неверный вариант в контексте данного вопроса.","C) всегда положительна":"❌ всегда положительна — неверный вариант в контексте данного вопроса.","D) произведение координат":"❌ произведение координат — неверный вариант в контексте данного вопроса."}}},{"id":47,"question":"47. Расстояние между точками M₁(1, 2, 3) и M₂(4, 6, 9) в пространстве равно:","answers":[{"text":"A) 7","correct":false},{"text":"B)  8","correct":false},{"text":"C) sqrt(61)","correct":false},{"text":"D) sqrt(65)","correct":true}],"explanation":{"correct":"Правильный ответ: sqrt(65)","details":{"A) 7":"❌ 7 — неверный вариант в контексте данного вопроса.","B)  8":"❌ 8 — неверный вариант в контексте данного вопроса.","C) sqrt(61)":"❌ sqrt(61) — неверный вариант в контексте данного вопроса."}}},{"id":48,"question":"48. Если точка M делит отрезок M₁M₂ в отношении λ = -0.5, то она расположена:","answers":[{"text":"A) между M₁ и M₂ ","correct":false},{"text":"B) вне отрезка M₁M₂","correct":true},{"text":"C) совпадает с M₁","correct":false},{"text":"D) совпадает с M₂","correct":false}],"explanation":{"correct":"Правильный ответ: вне отрезка M₁M₂","details":{"A) между M₁ и M₂ ":"❌ между M₁ и M₂ — неверный вариант в контексте данного вопроса.","C) совпадает с M₁":"❌ совпадает с M₁ — неверный вариант в контексте данного вопроса.","D) совпадает с M₂":"❌ совпадает с M₂ — неверный вариант в контексте данного вопроса."}}},{"id":49,"question":"49. Длина отрезка между точками A(–3, 4) и B(1, –2) равна:","answers":[{"text":"A) 6","correct":false},{"text":"B) sqrt(52)","correct":true},{"text":"C) 8","correct":false},{"text":"D) 10","correct":false}],"explanation":{"correct":"Правильный ответ: sqrt(52)","details":{"A) 6":"❌ 6 — неверный вариант в контексте данного вопроса.","C) 8":"❌ 8 — неверный вариант в контексте данного вопроса.","D) 10":"❌ 10 — неверный вариант в контексте данного вопроса."}}},{"id":50,"question":"50. Если M₁(0, 0), M₂(6, 8), то длина M₁M₂ равна:","answers":[{"text":"A) 10","correct":true},{"text":"B) 14","correct":false},{"text":"C)  12","correct":false},{"text":"D) 9","correct":false}],"explanation":{"correct":"Правильный ответ: 10","details":{"B) 14":"❌ 14 — неверный вариант в контексте данного вопроса.","C)  12":"❌ 12 — неверный вариант в контексте данного вопроса.","D) 9":"❌ 9 — неверный вариант в контексте данного вопроса."}}},{"id":51,"question":"51. Если точка M(2, 4) делит отрезок M₁(1, 2) и M₂(x₂, y₂) в отношении λ = 1, то M₂:","answers":[{"text":"A)(3, 6)","correct":true},{"text":"B) (4, 8)","correct":false},{"text":"C) (2, 4)","correct":false},{"text":"D)(5, 10)","correct":false}],"explanation":{"correct":"Правильный ответ: (3, 6)","details":{"B) (4, 8)":"❌ (4, 8) — неверный вариант в контексте данного вопроса.","C) (2, 4)":"❌ (2, 4) — неверный вариант в контексте данного вопроса.","D)(5, 10)":"❌ (5, 10) — неверный вариант в контексте данного вопроса."}}},{"id":52,"question":"52. Если M делит отрезок M₁M₂ так, что λ = 3, M₁(0,0), M₂(8,12), то M:","answers":[{"text":"A) (2, 3)","correct":false},{"text":"B) (6, 9)","correct":true},{"text":"C) (4, 6)","correct":false},{"text":"D) (8, 12)","correct":false}],"explanation":{"correct":"Правильный ответ: (6, 9)","details":{"A) (2, 3)":"❌ (2, 3) — неверный вариант в контексте данного вопроса.","C) (4, 6)":"❌ (4, 6) — неверный вариант в контексте данного вопроса.","D) (8, 12)":"❌ (8, 12) — неверный вариант в контексте данного вопроса."}}},{"id":53,"question":"53. Что такое числовая последовательность?","answers":[{"text":"A) Множество функций","correct":false},{"text":"B) Упорядоченный набор чисел","correct":true},{"text":"C) График на плоскости","correct":false},{"text":"D) Уравнение с одной переменной","correct":false}],"explanation":{"correct":"Правильный ответ: Упорядоченный набор чисел","details":{"A) Множество функций":"❌ Множество функций — неверный вариант в контексте данного вопроса.","C) График на плоскости":"❌ График на плоскости — неверный вариант в контексте данного вопроса.","D) Уравнение с одной переменной":"❌ Уравнение с одной переменной — неверный вариант в контексте данного вопроса."}}},{"id":54,"question":"54.  Что означает предел последовательности?","answers":[{"text":"A) Её первый элемент","correct":false},{"text":"B) Число, к которому стремятся члены последовательности","correct":true},{"text":"C) Сумма всех элементов","correct":false},{"text":"D) Максимальный элемент","correct":false}],"explanation":{"correct":"Правильный ответ: Число, к которому стремятся члены последовательности","details":{"A) Её первый элемент":"❌ Её первый элемент — неверный вариант в контексте данного вопроса.","C) Сумма всех элементов":"❌ Сумма всех элементов — неверный вариант в контексте данного вопроса.","D) Максимальный элемент":"❌ Максимальный элемент — неверный вариант в контексте данного вопроса."}}},{"id":55,"question":"55. Если последовательность возрастает и ограничена сверху, то она…","answers":[{"text":"A) Расходится","correct":false},{"text":"B) Имеет предел","correct":true},{"text":"C)  Не имеет предела","correct":false},{"text":"D) Является бесконечно большой","correct":false}],"explanation":{"correct":"Правильный ответ: Имеет предел","details":{"A) Расходится":"❌ Расходится — неверный вариант в контексте данного вопроса.","C)  Не имеет предела":"❌ Не имеет предела — неверный вариант в контексте данного вопроса.","D) Является бесконечно большой":"❌ Является бесконечно большой — неверный вариант в контексте данного вопроса."}}},{"id":56,"question":"56. Какая последовательность называется постоянной?","answers":[{"text":"A)Все её элементы равны","correct":true},{"text":"B) Она не имеет предела","correct":false},{"text":"C) Она стремится к нулю","correct":false},{"text":"D)Она монотонна","correct":false}],"explanation":{"correct":"Правильный ответ: Все её элементы равны","details":{"B) Она не имеет предела":"❌ Она не имеет предела — неверный вариант в контексте данного вопроса.","C) Она стремится к нулю":"❌ Она стремится к нулю — неверный вариант в контексте данного вопроса.","D)Она монотонна":"❌ Она монотонна — неверный вариант в контексте данного вопроса."}}},{"id":57,"question":"57. Функция y=sinx является:","answers":[{"text":"A) Чётной","correct":false},{"text":"B) Нечётной","correct":true},{"text":"C) Ни чётной, ни нечётной","correct":false},{"text":"D) Периодической с периодом π","correct":false}],"explanation":{"correct":"Правильный ответ: Нечётной","details":{"A) Чётной":"❌ Чётной — неверный вариант в контексте данного вопроса.","C) Ни чётной, ни нечётной":"❌ Ни чётной, ни нечётной — неверный вариант в контексте данного вопроса.","D) Периодической с периодом π":"❌ Периодической с периодом π — неверный вариант в контексте данного вопроса."}}},{"id":58,"question":"58. Период функции y=sinx равен:","answers":[{"text":"A) π","correct":false},{"text":"B) 2π","correct":true},{"text":"C) π/2","correct":false},{"text":"D) 4π","correct":false}],"explanation":{"correct":"Правильный ответ: 2π","details":{"A) π":"❌ π — неверный вариант в контексте данного вопроса.","C) π/2":"❌ π/2 — неверный вариант в контексте данного вопроса.","D) 4π":"❌ 4π — неверный вариант в контексте данного вопроса."}}},{"id":59,"question":"59. Период функции y=2sin(3x+2) равен:","answers":[{"text":"A) 2π","correct":false},{"text":"B) 2π/3","correct":true},{"text":"C) π/3","correct":false},{"text":"D) 3π","correct":false}],"explanation":{"correct":"Правильный ответ: 2π/3","details":{"A) 2π":"❌ 2π — неверный вариант в контексте данного вопроса.","C) π/3":"❌ π/3 — неверный вариант в контексте данного вопроса.","D) 3π":"❌ 3π — неверный вариант в контексте данного вопроса."}}},{"id":60,"question":"60. Функция y=sqrt(x) является периодической?","answers":[{"text":"A)  Да","correct":false},{"text":"B) Нет","correct":true},{"text":"C) Только при x>0","correct":false},{"text":"D) Только при x<0","correct":false}],"explanation":{"correct":"Правильный ответ: Нет","details":{"A)  Да":"❌ Да — неверный вариант в контексте данного вопроса.","C) Только при x>0":"❌ Только при x>0 — неверный вариант в контексте данного вопроса.","D) Только при x<0":"❌ Только при x<0 — неверный вариант в контексте данного вопроса."}}},{"id":61,"question":"61. Чему равен предел: lim (x→2) (5x² + 3x - 4)?","answers":[{"text":"A) 22","correct":true},{"text":"B) 20","correct":false},{"text":"C) 18","correct":false},{"text":"D) 24","correct":false}],"explanation":{"correct":"Правильный ответ: 22","details":{"B) 20":"❌ 20 — неверный вариант в контексте данного вопроса.","C) 18":"❌ 18 — неверный вариант в контексте данного вопроса.","D) 24":"❌ 24 — неверный вариант в контексте данного вопроса."}}},{"id":62,"question":"62. Чему равен предел: lim (x→4) (x² - 9x + 20) / (x - 4)?","answers":[{"text":"A) 0","correct":false},{"text":"B)1","correct":false},{"text":"C) -1","correct":true},{"text":"D) 4","correct":false}],"explanation":{"correct":"Правильный ответ: -1","details":{"A) 0":"❌ 0 — неверный вариант в контексте данного вопроса.","B)1":"❌ 1 — неверный вариант в контексте данного вопроса.","D) 4":"❌ 4 — неверный вариант в контексте данного вопроса."}}},{"id":63,"question":"63. Чему равен предел: lim (x→0) sin(3x) / (-2x)?","answers":[{"text":"A)  -3/2","correct":true},{"text":"B) 3/2","correct":false},{"text":"C) -2/3","correct":false},{"text":"D) 1","correct":false}],"explanation":{"correct":"Правильный ответ: -3/2","details":{"B) 3/2":"❌ 3/2 — неверный вариант в контексте данного вопроса.","C) -2/3":"❌ -2/3 — неверный вариант в контексте данного вопроса.","D) 1":"❌ 1 — неверный вариант в контексте данного вопроса."}}},{"id":64,"question":"64. Чему равен предел: lim (x→0) (1 + 3x)^(2/x)?","answers":[{"text":"A) e²","correct":false},{"text":"B) e⁶","correct":true},{"text":"C) e^(2/3)","correct":false},{"text":"D) 1","correct":false}],"explanation":{"correct":"Правильный ответ: e⁶","details":{"A) e²":"❌ e² — неверный вариант в контексте данного вопроса.","C) e^(2/3)":"❌ e^(2/3) — неверный вариант в контексте данного вопроса.","D) 1":"❌ 1 — неверный вариант в контексте данного вопроса."}}},{"id":65,"question":"65. Чему равна производная постоянной функции  C?","answers":[{"text":"A) C","correct":false},{"text":"B) 1","correct":false},{"text":"C) 0","correct":true},{"text":"D) x","correct":false}],"explanation":{"correct":"Правильный ответ: 0","details":{"A) C":"❌ C — неверный вариант в контексте данного вопроса.","B) 1":"❌ 1 — неверный вариант в контексте данного вопроса.","D) x":"❌ x — неверный вариант в контексте данного вопроса."}}},{"id":66,"question":"66.Чему равна производная функции y=sqrt(x) ?","answers":[{"text":"A) 1/(2*sqrt(x))","correct":true},{"text":"B) 1/(sqrt(x))","correct":false},{"text":"C)2*sqrt(x)","correct":false},{"text":"D) sqrt(x)","correct":false}],"explanation":{"correct":"Правильный ответ: 1/(2*sqrt(x))","details":{"B) 1/(sqrt(x))":"❌ 1/(sqrt(x)) — неверный вариант в контексте данного вопроса.","C)2*sqrt(x)":"❌ 2*sqrt(x) — неверный вариант в контексте данного вопроса.","D) sqrt(x)":"❌ sqrt(x) — неверный вариант в контексте данного вопроса."}}},{"id":67,"question":"67. Чему равна производная функции y=e^x ?","answers":[{"text":"A) xe^(x−1)","correct":false},{"text":"B) e^x","correct":true},{"text":"C) lnx","correct":false},{"text":"D) 1/x","correct":false}],"explanation":{"correct":"Правильный ответ: e^x","details":{"A) xe^(x−1)":"❌ xe^(x−1) — неверный вариант в контексте данного вопроса.","C) lnx":"❌ lnx — неверный вариант в контексте данного вопроса.","D) 1/x":"❌ 1/x — неверный вариант в контексте данного вопроса."}}},{"id":68,"question":"68. Чему равна производная функции y=lnx?","answers":[{"text":"A) 1/x","correct":false},{"text":"B)x","correct":false},{"text":"C) e^x","correct":true},{"text":"D) lnx","correct":false}],"explanation":{"correct":"Правильный ответ: e^x","details":{"A) 1/x":"❌ 1/x — неверный вариант в контексте данного вопроса.","B)x":"❌ x — неверный вариант в контексте данного вопроса.","D) lnx":"❌ lnx — неверный вариант в контексте данного вопроса."}}},{"id":69,"question":"69. Как записывается правило дифференцирования произведения двух функций U(x) и V(x)?","answers":[{"text":"A) U ′ V−UV ′","correct":false},{"text":"B) U ′ V+UV ′","correct":true},{"text":"C) (U ′ V−UV ′)/V^2","correct":false},{"text":"D) U ′ + V ′","correct":false}],"explanation":{"correct":"Правильный ответ: U ′ V+UV ′","details":{"A) U ′ V−UV ′":"❌ U ′ V−UV ′ — неверный вариант в контексте данного вопроса.","C) (U ′ V−UV ′)/V^2":"❌ (U ′ V−UV ′)/V^2 — неверный вариант в контексте данного вопроса.","D) U ′ + V ′":"❌ U ′ + V ′ — неверный вариант в контексте данного вопроса."}}},{"id":70,"question":"70. Каков геометрический смысл производной?","answers":[{"text":"A) Длина касательной.","correct":false},{"text":"B) Угловой коэффициент касательной.","correct":true},{"text":"C)Площадь под кривой.","correct":false},{"text":"D) Скорость изменения аргумента.","correct":false}],"explanation":{"correct":"Правильный ответ: Угловой коэффициент касательной.","details":{"A) Длина касательной.":"❌ Длина касательной. — неверный вариант в контексте данного вопроса.","C)Площадь под кривой.":"❌ Площадь под кривой. — неверный вариант в контексте данного вопроса.","D) Скорость изменения аргумента.":"❌ Скорость изменения аргумента. — неверный вариант в контексте данного вопроса."}}},{"id":71,"question":"71. Чему равна производная функции y=sinx?","answers":[{"text":"A) cosx","correct":true},{"text":"B)-cosx","correct":false},{"text":"C) -sinx","correct":false},{"text":"D) tgx","correct":false}],"explanation":{"correct":"Правильный ответ: cosx","details":{"B)-cosx":"❌ -cosx — неверный вариант в контексте данного вопроса.","C) -sinx":"❌ -sinx — неверный вариант в контексте данного вопроса.","D) tgx":"❌ tgx — неверный вариант в контексте данного вопроса."}}},{"id":72,"question":"72. Чему равна производная функции y=cosx?","answers":[{"text":"A) sinx","correct":false},{"text":"B) cosx","correct":false},{"text":"C) -sinx","correct":true},{"text":"D) -cosx","correct":false}],"explanation":{"correct":"Правильный ответ: -sinx","details":{"A) sinx":"❌ sinx — неверный вариант в контексте данного вопроса.","B) cosx":"❌ cosx — неверный вариант в контексте данного вопроса.","D) -cosx":"❌ -cosx — неверный вариант в контексте данного вопроса."}}},{"id":73,"question":"73. Производная функции y=x^n  равна:","answers":[{"text":"A)nx^(n−1)\n ","correct":true},{"text":"B) x^(n−1)","correct":false},{"text":"C) nx^n","correct":false},{"text":"D) x^nlnx","correct":false}],"explanation":{"correct":"Правильный ответ: nx^(n−1)","details":{"B) x^(n−1)":"❌ x^(n−1) — неверный вариант в контексте данного вопроса.","C) nx^n":"❌ nx^n — неверный вариант в контексте данного вопроса.","D) x^nlnx":"❌ x^nlnx — неверный вариант в контексте данного вопроса."}}},{"id":74,"question":"74.Производная функции y=lnx равна:","answers":[{"text":"A) 1/x","correct":true},{"text":"B) 1/xln10","correct":false},{"text":"C)lnx","correct":false},{"text":"D) x","correct":false}],"explanation":{"correct":"Правильный ответ: 1/x","details":{"B) 1/xln10":"❌ 1/xln10 — неверный вариант в контексте данного вопроса.","C)lnx":"❌ lnx — неверный вариант в контексте данного вопроса.","D) x":"❌ x — неверный вариант в контексте данного вопроса."}}},{"id":75,"question":"75. Что представляет собой дифференциал функции dy?","answers":[{"text":"A)  Полное приращение функции Δy.","correct":false},{"text":"B) Вторая производная функции.","correct":false},{"text":"C) Главная линейная часть приращения функции.","correct":true},{"text":"D) Уравнение нормали.","correct":false}],"explanation":{"correct":"Правильный ответ: Главная линейная часть приращения функции.","details":{"A)  Полное приращение функции Δy.":"❌ Полное приращение функции Δy. — неверный вариант в контексте данного вопроса.","B) Вторая производная функции.":"❌ Вторая производная функции. — неверный вариант в контексте данного вопроса.","D) Уравнение нормали.":"❌ Уравнение нормали. — неверный вариант в контексте данного вопроса."}}},{"id":76,"question":"76. Каков геометрический смысл производной?","answers":[{"text":"A) Длина касательной.","correct":false},{"text":"B) Угловой коэффициент касательной.","correct":true},{"text":"C)Площадь под кривой.","correct":false},{"text":"D) Скорость изменения аргумента.","correct":false}],"explanation":{"correct":"Правильный ответ: Угловой коэффициент касательной.","details":{"A) Длина касательной.":"❌ Длина касательной. — неверный вариант в контексте данного вопроса.","C)Площадь под кривой.":"❌ Площадь под кривой. — неверный вариант в контексте данного вопроса.","D) Скорость изменения аргумента.":"❌ Скорость изменения аргумента. — неверный вариант в контексте данного вопроса."}}},{"id":77,"question":"77. Производная функции y=tgx равна:","answers":[{"text":"A) 1/(cosx)^2","correct":true},{"text":"B)-1/(sinx)^2","correct":false},{"text":"C) 1/(sinx)^2","correct":false},{"text":"D) -1/(cosx)^2","correct":false}],"explanation":{"correct":"Правильный ответ: 1/(cosx)^2","details":{"B)-1/(sinx)^2":"❌ -1/(sinx)^2 — неверный вариант в контексте данного вопроса.","C) 1/(sinx)^2":"❌ 1/(sinx)^2 — неверный вариант в контексте данного вопроса.","D) -1/(cosx)^2":"❌ -1/(cosx)^2 — неверный вариант в контексте данного вопроса."}}},{"id":78,"question":"78. Чему равна производная функции y=arctgx?","answers":[{"text":"A) 1/1+x^2","correct":true},{"text":"B) -1/1+x^2","correct":false},{"text":"C) 1/sqrt(1-x^2)","correct":false},{"text":"D) -1/sqrt(1-x^2)","correct":false}],"explanation":{"correct":"Правильный ответ: 1/1+x^2","details":{"B) -1/1+x^2":"❌ -1/1+x^2 — неверный вариант в контексте данного вопроса.","C) 1/sqrt(1-x^2)":"❌ 1/sqrt(1-x^2) — неверный вариант в контексте данного вопроса.","D) -1/sqrt(1-x^2)":"❌ -1/sqrt(1-x^2) — неверный вариант в контексте данного вопроса."}}},{"id":79,"question":"79. Что называется графиком функции z=f(x,y)?","answers":[{"text":"A) Линия на плоскости xOy, заданная уравнением f(x,y)=C.","correct":false},{"text":"B) Множество точек плоскости (x,y,0).","correct":false},{"text":"C) Множество точек пространства (x,y,f(x,y)) для (x,y)∈D(z).","correct":true},{"text":"D) Множество точек пространства (x,y,z), удовлетворяющих F (x,y,z)=0.","correct":false}],"explanation":{"correct":"Правильный ответ: Множество точек пространства (x,y,f(x,y)) для (x,y)∈D(z).","details":{"A) Линия на плоскости xOy, заданная уравнением f(x,y)=C.":"❌ Линия на плоскости xOy, заданная уравнением f(x,y)=C. — неверный вариант в контексте данного вопроса.","B) Множество точек плоскости (x,y,0).":"❌ Множество точек плоскости (x,y,0). — неверный вариант в контексте данного вопроса.","D) Множество точек пространства (x,y,z), удовлетворяющих F (x,y,z)=0.":"❌ Множество точек пространства (x,y,z), удовлетворяющих F (x,y,z)=0. — неверный вариант в контексте данного вопроса."}}},{"id":80,"question":"80. Функция f(M) называется непрерывной в точке M_{0} , если:","answers":[{"text":"A) lim M→M_{0}  f(M) существует.","correct":false},{"text":"B) lim M→M_{0} f(M)=f(M_{0} ).","correct":true},{"text":"C) f(M) определена в M_{0}","correct":false},{"text":"D) f(M) имеет частные производные в M_{0}","correct":false}],"explanation":{"correct":"Правильный ответ: lim M→M_{0} f(M)=f(M_{0} ).","details":{"A) lim M→M_{0}  f(M) существует.":"❌ lim M→M_{0}  f(M) существует. — неверный вариант в контексте данного вопроса.","C) f(M) определена в M_{0}":"❌ f(M) определена в M_{0} — неверный вариант в контексте данного вопроса.","D) f(M) имеет частные производные в M_{0}":"❌ f(M) имеет частные производные в M_{0} — неверный вариант в контексте данного вопроса."}}},{"id":81,"question":"81. Если z=f(x,y) дифференцируема в точке M_{0} , то верно, что: ","answers":[{"text":"A) Она непрерывна в M_{0} , но может не иметь частных производных.","correct":false},{"text":"B)Она имеет частные производные, но может быть разрывной.","correct":false},{"text":"C) Она непрерывна в M_{0}   и имеет частные производные.","correct":true},{"text":"D) Она обязательно имеет непрерывные частные производные.","correct":false}],"explanation":{"correct":"Правильный ответ: Она непрерывна в M_{0}   и имеет частные производные.","details":{"A) Она непрерывна в M_{0} , но может не иметь частных производных.":"❌ Она непрерывна в M_{0} , но может не иметь частных производных. — неверный вариант в контексте данного вопроса.","B)Она имеет частные производные, но может быть разрывной.":"❌ Она имеет частные производные, но может быть разрывной. — неверный вариант в контексте данного вопроса.","D) Она обязательно имеет непрерывные частные производные.":"❌ Она обязательно имеет непрерывные частные производные. — неверный вариант в контексте данного вопроса."}}},{"id":82,"question":"82. Что такое смешанная частная производная?","answers":[{"text":"A) Производная, взятая дважды по одной переменной.","correct":false},{"text":"B) Производная, взятая по разным переменным.","correct":true},{"text":"C) Производная, взятая по времени.","correct":false},{"text":"D) Производная от сложной функции.","correct":false}],"explanation":{"correct":"Правильный ответ: Производная, взятая по разным переменным.","details":{"A) Производная, взятая дважды по одной переменной.":"❌ Производная, взятая дважды по одной переменной. — неверный вариант в контексте данного вопроса.","C) Производная, взятая по времени.":"❌ Производная, взятая по времени. — неверный вариант в контексте данного вопроса.","D) Производная от сложной функции.":"❌ Производная от сложной функции. — неверный вариант в контексте данного вопроса."}}},{"id":83,"question":"83. В каком направлении градиент указывает?","answers":[{"text":"A) Направление наискорейшего убывания функции.","correct":false},{"text":"B)Направление наискорейшего возрастания функции.","correct":true},{"text":"C) Направление линии уровня.","correct":false},{"text":"D) Направление оси Ox.","correct":false}],"explanation":{"correct":"Правильный ответ: Направление наискорейшего возрастания функции.","details":{"A) Направление наискорейшего убывания функции.":"❌ Направление наискорейшего убывания функции. — неверный вариант в контексте данного вопроса.","C) Направление линии уровня.":"❌ Направление линии уровня. — неверный вариант в контексте данного вопроса.","D) Направление оси Ox.":"❌ Направление оси Ox. — неверный вариант в контексте данного вопроса."}}},{"id":84,"question":"84. Если F(x) — первообразная для f(x), то какая функция также будет первообразной?","answers":[{"text":"A)F(x)+5\n ","correct":false},{"text":"B) F(x)⋅C","correct":false},{"text":"C) F(x)+C","correct":true},{"text":"D) F(x)−x","correct":false}],"explanation":{"correct":"Правильный ответ: F(x)+C","details":{"A)F(x)+5\n ":"❌ F(x)+5 — неверный вариант в контексте данного вопроса.","B) F(x)⋅C":"❌ F(x)⋅C — неверный вариант в контексте данного вопроса.","D) F(x)−x":"❌ F(x)−x — неверный вариант в контексте данного вопроса."}}},{"id":85,"question":"85. Как обозначается неопределенный интеграл функции f(x)?","answers":[{"text":"A) ∫f(x)dx","correct":true},{"text":"B) df(x)/dx","correct":false},{"text":"C) f ′ (x)","correct":false},{"text":"D) F(x)","correct":false}],"explanation":{"correct":"Правильный ответ: ∫f(x)dx","details":{"B) df(x)/dx":"❌ df(x)/dx — неверный вариант в контексте данного вопроса.","C) f ′ (x)":"❌ f ′ (x) — неверный вариант в контексте данного вопроса.","D) F(x)":"❌ F(x) — неверный вариант в контексте данного вопроса."}}},{"id":86,"question":"86.Что означает символ ∫?","answers":[{"text":"A) Дифференцирование","correct":false},{"text":"B) Интегрирование","correct":true},{"text":"C)Суммирование","correct":false},{"text":"D)Умножение","correct":false}],"explanation":{"correct":"Правильный ответ: Интегрирование","details":{"A) Дифференцирование":"❌ Дифференцирование — неверный вариант в контексте данного вопроса.","C)Суммирование":"❌ Суммирование — неверный вариант в контексте данного вопроса.","D)Умножение":"❌ Умножение — неверный вариант в контексте данного вопроса."}}},{"id":87,"question":"87. Какие операции являются взаимно обратными?","answers":[{"text":"A) Сложение и вычитание","correct":false},{"text":"B) Умножение и деление","correct":false},{"text":"C) Интегрирование и дифференцирование","correct":true},{"text":"D) Возведение в степень и извлечение корня","correct":false}],"explanation":{"correct":"Правильный ответ: Интегрирование и дифференцирование","details":{"A) Сложение и вычитание":"❌ Сложение и вычитание — неверный вариант в контексте данного вопроса.","B) Умножение и деление":"❌ Умножение и деление — неверный вариант в контексте данного вопроса.","D) Возведение в степень и извлечение корня":"❌ Возведение в степень и извлечение корня — неверный вариант в контексте данного вопроса."}}},{"id":88,"question":"88. Что такое подынтегральная функция?","answers":[{"text":"A) Функция, которую интегрируют","correct":true},{"text":"B)Функция, которую дифференцируют","correct":false},{"text":"C) Первообразная","correct":false},{"text":"D) Предел интегрирования","correct":false}],"explanation":{"correct":"Правильный ответ: Функция, которую интегрируют","details":{"B)Функция, которую дифференцируют":"❌ Функция, которую дифференцируют — неверный вариант в контексте данного вопроса.","C) Первообразная":"❌ Первообразная — неверный вариант в контексте данного вопроса.","D) Предел интегрирования":"❌ Предел интегрирования — неверный вариант в контексте данного вопроса."}}},{"id":89,"question":"89. Что такое определенный интеграл?","answers":[{"text":"A) Множество всех первообразных","correct":false},{"text":"B) Предел интегральных сумм","correct":true},{"text":"C) Производная функции","correct":false},{"text":"D) Дифференциал функции","correct":false}],"explanation":{"correct":"Правильный ответ: Предел интегральных сумм","details":{"A) Множество всех первообразных":"❌ Множество всех первообразных — неверный вариант в контексте данного вопроса.","C) Производная функции":"❌ Производная функции — неверный вариант в контексте данного вопроса.","D) Дифференциал функции":"❌ Дифференциал функции — неверный вариант в контексте данного вопроса."}}},{"id":90,"question":"90. Какая формула связывает определенный интеграл и первообразную?","answers":[{"text":"A)  Формула Лейбница","correct":false},{"text":"B) Формула Ньютона—Лейбница","correct":true},{"text":"C) Формула Буняковского","correct":false},{"text":"D) Формула Остроградского","correct":false}],"explanation":{"correct":"Правильный ответ: Формула Ньютона—Лейбница","details":{"A)  Формула Лейбница":"❌ Формула Лейбница — неверный вариант в контексте данного вопроса.","C) Формула Буняковского":"❌ Формула Буняковского — неверный вариант в контексте данного вопроса.","D) Формула Остроградского":"❌ Формула Остроградского — неверный вариант в контексте данного вопроса."}}},{"id":91,"question":"91. Чему равен ∫cos(x)dx?","answers":[{"text":"A) sin(x)+C","correct":true},{"text":"B)−sin(x)+C","correct":false},{"text":"C) cos(x)+C","correct":false},{"text":"D) −cos(x)+C","correct":false}],"explanation":{"correct":"Правильный ответ: sin(x)+C","details":{"B)−sin(x)+C":"❌ −sin(x)+C — неверный вариант в контексте данного вопроса.","C) cos(x)+C":"❌ cos(x)+C — неверный вариант в контексте данного вопроса.","D) −cos(x)+C":"❌ −cos(x)+C — неверный вариант в контексте данного вопроса."}}},{"id":92,"question":"92. Что называется дифференциальным уравнением?","answers":[{"text":"A)Уравнение, содержащее только функцию\n ","correct":false},{"text":"B) Уравнение, содержащее функцию, её аргумент и производные","correct":true},{"text":"C) Уравнение, содержащее только производные","correct":false},{"text":"D) Уравнение, содержащее только аргумент","correct":false}],"explanation":{"correct":"Правильный ответ: Уравнение, содержащее функцию, её аргумент и производные","details":{"A)Уравнение, содержащее только функцию\n ":"❌ Уравнение, содержащее только функцию — неверный вариант в контексте данного вопроса.","C) Уравнение, содержащее только производные":"❌ Уравнение, содержащее только производные — неверный вариант в контексте данного вопроса.","D) Уравнение, содержащее только аргумент":"❌ Уравнение, содержащее только аргумент — неверный вариант в контексте данного вопроса."}}},{"id":93,"question":"93. Как называется дифференциальное уравнение, если искомая функция зависит от одного аргумента?","answers":[{"text":"A) В частных производных","correct":false},{"text":"B) Обыкновенное","correct":true},{"text":"C) Линейное","correct":false},{"text":"D) Однородное","correct":false}],"explanation":{"correct":"Правильный ответ: Обыкновенное","details":{"A) В частных производных":"❌ В частных производных — неверный вариант в контексте данного вопроса.","C) Линейное":"❌ Линейное — неверный вариант в контексте данного вопроса.","D) Однородное":"❌ Однородное — неверный вариант в контексте данного вопроса."}}},{"id":94,"question":"94.Что такое порядок дифференциального уравнения?","answers":[{"text":"A) Количество переменных","correct":false},{"text":"B) Порядок старшей производной","correct":true},{"text":"C)Количество решений","correct":false},{"text":"D)Степень функции","correct":false}],"explanation":{"correct":"Правильный ответ: Порядок старшей производной","details":{"A) Количество переменных":"❌ Количество переменных — неверный вариант в контексте данного вопроса.","C)Количество решений":"❌ Количество решений — неверный вариант в контексте данного вопроса.","D)Степень функции":"❌ Степень функции — неверный вариант в контексте данного вопроса."}}},{"id":95,"question":"95. Что такое общее решение дифференциального уравнения?","answers":[{"text":"A) Решение без постоянных","correct":false},{"text":"B) Решение, содержащее произвольные постоянные в количестве, равном порядку уравнения","correct":true},{"text":"C) Решение, удовлетворяющее начальным условиям","correct":false},{"text":"D) Решение в явном виде","correct":false}],"explanation":{"correct":"Правильный ответ: Решение, содержащее произвольные постоянные в количестве, равном порядку уравнения","details":{"A) Решение без постоянных":"❌ Решение без постоянных — неверный вариант в контексте данного вопроса.","C) Решение, удовлетворяющее начальным условиям":"❌ Решение, удовлетворяющее начальным условиям — неверный вариант в контексте данного вопроса.","D) Решение в явном виде":"❌ Решение в явном виде — неверный вариант в контексте данного вопроса."}}},{"id":96,"question":"96. Как называется решение дифференциального уравнения, удовлетворяющее начальным условиям?","answers":[{"text":"A) Общее","correct":false},{"text":"B)Частное","correct":true},{"text":"C) Общий интеграл","correct":false},{"text":"D) Полное","correct":false}],"explanation":{"correct":"Правильный ответ: Частное","details":{"A) Общее":"❌ Общее — неверный вариант в контексте данного вопроса.","C) Общий интеграл":"❌ Общий интеграл — неверный вариант в контексте данного вопроса.","D) Полное":"❌ Полное — неверный вариант в контексте данного вопроса."}}},{"id":97,"question":"97. Какие уравнения относятся к ДУ первого порядка с разделяющимися переменными?","answers":[{"text":"A) y′ =f(x)+g(y)","correct":false},{"text":"B) y′ =f(x)*g(y)","correct":true},{"text":"C) y′ =f(x)/g(y)","correct":false},{"text":"D) y′ =f(y/x)","correct":false}],"explanation":{"correct":"Правильный ответ: y′ =f(x)*g(y)","details":{"A) y′ =f(x)+g(y)":"❌ y′ =f(x)+g(y) — неверный вариант в контексте данного вопроса.","C) y′ =f(x)/g(y)":"❌ y′ =f(x)/g(y) — неверный вариант в контексте данного вопроса.","D) y′ =f(y/x)":"❌ y′ =f(y/x) — неверный вариант в контексте данного вопроса."}}},{"id":98,"question":"98. Как решаются однородные ДУ первого порядка?","answers":[{"text":"A)  Интегрированием","correct":false},{"text":"B) Заменой y=ux","correct":true},{"text":"C) Разделением переменных","correct":false},{"text":"D) Подстановкой y′=p","correct":false}],"explanation":{"correct":"Правильный ответ: Заменой y=ux","details":{"A)  Интегрированием":"❌ Интегрированием — неверный вариант в контексте данного вопроса.","C) Разделением переменных":"❌ Разделением переменных — неверный вариант в контексте данного вопроса.","D) Подстановкой y′=p":"❌ Подстановкой y′=p — неверный вариант в контексте данного вопроса."}}},{"id":99,"question":"99. Какой вид имеет однородное ДУ первого порядка?","answers":[{"text":"A) y′=f(x)+g(y)","correct":false},{"text":"B)y′=f(y/x)","correct":true},{"text":"C)y′ =f(x)⋅y","correct":false},{"text":"D) y′ =f(x)/y","correct":false}],"explanation":{"correct":"Правильный ответ: y′=f(y/x)","details":{"A) y′=f(x)+g(y)":"❌ y′=f(x)+g(y) — неверный вариант в контексте данного вопроса.","C)y′ =f(x)⋅y":"❌ y′ =f(x)⋅y — неверный вариант в контексте данного вопроса.","D) y′ =f(x)/y":"❌ y′ =f(x)/y — неверный вариант в контексте данного вопроса."}}},{"id":100,"question":"100. Что такое ДУ в полных дифференциалах?","answers":[{"text":"A) Уравнение, где Mdx+Ndy=0 является полным дифференциалом","correct":true},{"text":"B)Уравнение с разделяющимися переменными","correct":false},{"text":"C) Однородное уравнение","correct":false},{"text":"D) Линейное уравнение","correct":false}],"explanation":{"correct":"Правильный ответ: Уравнение, где Mdx+Ndy=0 является полным дифференциалом","details":{"B)Уравнение с разделяющимися переменными":"❌ Уравнение с разделяющимися переменными — неверный вариант в контексте данного вопроса.","C) Однородное уравнение":"❌ Однородное уравнение — неверный вариант в контексте данного вопроса.","D) Линейное уравнение":"❌ Линейное уравнение — неверный вариант в контексте данного вопроса."}}}];  // Будет заменено на реальные данные

export default function MathExam() {
  const [mode, setMode] = useState(null);
  const [currentQ, setCurrentQ] = useState(0);
  const [answers, setAnswers] = useState({});
  const [skipped, setSkipped] = useState({});
  const [showResult, setShowResult] = useState(false);
  const [showExamResults, setShowExamResults] = useState(false);
  const [showReview, setShowReview] = useState(false);
  const [reviewFilter, setReviewFilter] = useState('all'); // 'all', 'correct', 'incorrect', 'skipped'
  const [shuffledAnswers, setShuffledAnswers] = useState({});

  // Загрузка прогресса из localStorage
  useEffect(() => {
    const saved = localStorage.getItem('math_exam_progress');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        setAnswers(data.answers || {});
        setSkipped(data.skipped || {});
        setCurrentQ(data.currentQ || 0);
        setMode(data.mode || null);
      } catch (e) {
        console.error('Ошибка загрузки прогресса:', e);
      }
    }
  }, []);

  // Автосохранение прогресса
  useEffect(() => {
    if (mode) {
      const data = {
        answers,
        skipped,
        currentQ,
        mode
      };
      localStorage.setItem('math_exam_progress', JSON.stringify(data));
    }
  }, [answers, skipped, currentQ, mode]);

  // Перемешивание ответов для текущего вопроса
  useEffect(() => {
    const question = QUESTIONS_DATA[currentQ];
    if (question && !shuffledAnswers[question.id]) {
      setShuffledAnswers({
        ...shuffledAnswers,
        [question.id]: shuffleArray(question.answers)
      });
    }
  }, [currentQ]);

  const question = QUESTIONS_DATA[currentQ];
  const displayAnswers = shuffledAnswers[question?.id] || question?.answers || [];
  const userAnswer = answers[question?.id];
  const isSkipped = skipped[question?.id];
  const correctAnswer = question?.answers.find(a => a.correct);
  const isCorrect = userAnswer === correctAnswer?.text;

  const handleAnswer = (answerText) => {
    const newAnswers = { ...answers, [question.id]: answerText };
    setAnswers(newAnswers);
    
    // Убираем из пропущенных если отвечаем
    if (skipped[question.id]) {
      const newSkipped = { ...skipped };
      delete newSkipped[question.id];
      setSkipped(newSkipped);
    }
    
    if (mode === 'training') {
      setShowResult(true);
    }
  };

  const handleSkip = () => {
    setSkipped({ ...skipped, [question.id]: true });
    nextQuestion();
  };

  const nextQuestion = () => {
    if (currentQ < QUESTIONS_DATA.length - 1) {
      setCurrentQ(currentQ + 1);
      setShowResult(false);
    } else if (mode === 'exam') {
      setShowExamResults(true);
    }
  };

  const prevQuestion = () => {
    if (currentQ > 0) {
      setCurrentQ(currentQ - 1);
      setShowResult(false);
    }
  };

  const reset = () => {
    setCurrentQ(0);
    setAnswers({});
    setSkipped({});
    setShowResult(false);
    setShowExamResults(false);
    setShowReview(false);
    setMode(null);
    localStorage.removeItem('math_exam_progress');
  };

  const saveProgress = () => {
    alert('✅ Прогресс сохранён! Можешь закрыть страницу и вернуться позже.');
  };

  const stats = {
    answered: Object.keys(answers).length,
    skippedCount: Object.keys(skipped).length,
    correct: Object.entries(answers).filter(([qId, ans]) => {
      const q = QUESTIONS_DATA.find(qu => qu.id === parseInt(qId));
      return ans === q?.answers.find(a => a.correct)?.text;
    }).length,
    total: QUESTIONS_DATA.length
  };

  // Режим выбора
  if (!mode) {
    const hasSavedProgress = localStorage.getItem('math_exam_progress');
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-8">
        <div className="max-w-2xl mx-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-8">
            <div className="text-center mb-8">
              <BookOpen className="w-16 h-16 mx-auto text-purple-600 mb-4" />
              <h1 className="text-3xl font-bold text-gray-900 mb-2">Тест по Математике</h1>
              <p className="text-gray-600">Выберите режим подготовки</p>
            </div>

            {hasSavedProgress && (
              <div className="mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                <p className="text-sm text-blue-800">
                  <strong>Найден сохранённый прогресс!</strong> Выберите режим чтобы продолжить.
                </p>
              </div>
            )}

            <div className="space-y-4">
              <button
                onClick={() => setMode('training')}
                className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg hover:shadow-xl"
              >
                <div className="flex items-center justify-between">
                  <div className="text-left">
                    <h3 className="text-xl font-bold mb-1">Режим тренировки</h3>
                    <p className="text-sm text-green-100">Мгновенная проверка и детальные пояснения</p>
                  </div>
                  <CheckCircle className="w-8 h-8" />
                </div>
              </button>

              <button
                onClick={() => setMode('exam')}
                className="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-xl hover:from-orange-600 hover:to-red-700 transition-all shadow-lg hover:shadow-xl"
              >
                <div className="flex items-center justify-between">
                  <div className="text-left">
                    <h3 className="text-xl font-bold mb-1">Режим экзамена</h3>
                    <p className="text-sm text-orange-100">Результаты и детальный разбор в конце</p>
                  </div>
                  <Trophy className="w-8 h-8" />
                </div>
              </button>
            </div>

            <div className="mt-8 p-4 bg-purple-50 rounded-lg">
              <p className="text-sm text-purple-900">
                <strong>Всего вопросов:</strong> {QUESTIONS_DATA.length}
              </p>
              <p className="text-xs text-purple-700 mt-2">
                💾 Прогресс сохраняется автоматически
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Детальный разбор пройденных вопросов
  if (showReview) {
    const answeredQuestions = QUESTIONS_DATA.filter(q => answers[q.id] || skipped[q.id]);
    
    const filteredQuestions = answeredQuestions.filter(q => {
      if (reviewFilter === 'all') return true;
      if (reviewFilter === 'correct') {
        return answers[q.id] === q.answers.find(a => a.correct)?.text;
      }
      if (reviewFilter === 'incorrect') {
        return answers[q.id] && answers[q.id] !== q.answers.find(a => a.correct)?.text;
      }
      if (reviewFilter === 'skipped') {
        return skipped[q.id];
      }
      return true;
    });

    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-8">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-8">
            <div className="flex items-center justify-between mb-6">
              <div>
                <h2 className="text-2xl font-bold text-gray-900">Разбор пройденных вопросов</h2>
                <p className="text-gray-600">Отвечено: {answeredQuestions.length} из {QUESTIONS_DATA.length}</p>
              </div>
              <button
                onClick={() => setShowReview(false)}
                className="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors"
              >
                Назад к тесту
              </button>
            </div>

            {/* Фильтры */}
            <div className="flex gap-2 mb-6 flex-wrap">
              <button
                onClick={() => setReviewFilter('all')}
                className={`px-4 py-2 rounded-lg transition-colors ${
                  reviewFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Все ({answeredQuestions.length})
              </button>
              <button
                onClick={() => setReviewFilter('correct')}
                className={`px-4 py-2 rounded-lg transition-colors ${
                  reviewFilter === 'correct' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Правильные ({stats.correct})
              </button>
              <button
                onClick={() => setReviewFilter('incorrect')}
                className={`px-4 py-2 rounded-lg transition-colors ${
                  reviewFilter === 'incorrect' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Ошибки ({stats.answered - stats.correct})
              </button>
              <button
                onClick={() => setReviewFilter('skipped')}
                className={`px-4 py-2 rounded-lg transition-colors ${
                  reviewFilter === 'skipped' ? 'bg-orange-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Пропущенные ({stats.skippedCount})
              </button>
            </div>

            {/* Список вопросов */}
            <div className="space-y-4 max-h-[600px] overflow-y-auto">
              {filteredQuestions.map((q, idx) => {
                const userAns = answers[q.id];
                const correctAns = q.answers.find(a => a.correct);
                const isRight = userAns === correctAns?.text;
                const isSkip = skipped[q.id];
                
                return (
                  <div key={q.id} className={`p-6 rounded-lg border-2 ${
                    isSkip ? 'bg-orange-50 border-orange-200' :
                    isRight ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'
                  }`}>
                    <div className="flex items-start gap-3 mb-4">
                      {isSkip ? (
                        <SkipForward className="w-6 h-6 text-orange-600 flex-shrink-0 mt-1" />
                      ) : isRight ? (
                        <CheckCircle className="w-6 h-6 text-green-600 flex-shrink-0 mt-1" />
                      ) : (
                        <XCircle className="w-6 h-6 text-red-600 flex-shrink-0 mt-1" />
                      )}
                      <div className="flex-1">
                        <p className="font-bold text-gray-900 mb-3">{q.question}</p>
                        
                        {isSkip ? (
                          <p className="text-sm text-orange-700 mb-2">Вопрос был пропущен</p>
                        ) : (
                          <div className="mb-3">
                            <p className="text-sm font-medium text-gray-700 mb-1">Ваш ответ:</p>
                            <p className={`text-sm ${isRight ? 'text-green-700' : 'text-red-700'}`}>
                              {userAns}
                            </p>
                          </div>
                        )}
                        
                        <div className="mb-3">
                          <p className="text-sm font-medium text-gray-700 mb-1">Правильный ответ:</p>
                          <p className="text-sm text-green-700 font-medium">{correctAns?.text}</p>
                        </div>
                        
                        {/* Пояснение */}
                        <div className="mt-4 p-4 bg-white rounded-lg border border-gray-200">
                          <p className="text-sm font-bold text-gray-800 mb-2">📚 Объяснение:</p>
                          <p className="text-sm text-gray-700 whitespace-pre-line">
                            {isSkip 
                              ? q.explanation?.correct || correctAns?.text
                              : getExplanation(q, userAns, isRight)
                            }
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>

            {filteredQuestions.length === 0 && (
              <div className="text-center py-12 text-gray-500">
                <Filter className="w-12 h-12 mx-auto mb-4 opacity-50" />
                <p>Нет вопросов по выбранному фильтру</p>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Результаты экзамена
  if (showExamResults) {
    const percentage = Math.round((stats.correct / QUESTIONS_DATA.length) * 100);
    const passed = percentage >= 70;

    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-8">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-8">
            <div className="text-center mb-8">
              {passed ? (
                <Trophy className="w-20 h-20 mx-auto text-green-500 mb-4" />
              ) : (
                <AlertCircle className="w-20 h-20 mx-auto text-orange-500 mb-4" />
              )}
              <h1 className="text-3xl font-bold text-gray-900 mb-2">
                {passed ? 'Экзамен сдан!' : 'Нужно ещё потренироваться'}
              </h1>
              <p className="text-2xl font-bold text-purple-600">{percentage}%</p>
            </div>

            <div className="grid grid-cols-4 gap-4 mb-8">
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <p className="text-3xl font-bold text-green-600">{stats.correct}</p>
                <p className="text-sm text-gray-600">Правильных</p>
              </div>
              <div className="bg-red-50 p-4 rounded-lg text-center">
                <p className="text-3xl font-bold text-red-600">{stats.answered - stats.correct}</p>
                <p className="text-sm text-gray-600">Ошибок</p>
              </div>
              <div className="bg-orange-50 p-4 rounded-lg text-center">
                <p className="text-3xl font-bold text-orange-600">{stats.skippedCount}</p>
                <p className="text-sm text-gray-600">Пропущено</p>
              </div>
              <div className="bg-purple-50 p-4 rounded-lg text-center">
                <p className="text-3xl font-bold text-purple-600">{QUESTIONS_DATA.length}</p>
                <p className="text-sm text-gray-600">Всего</p>
              </div>
            </div>

            <div className="space-y-3 mb-6">
              <button
                onClick={() => setShowReview(true)}
                className="w-full bg-purple-600 text-white py-4 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 font-medium"
              >
                <ClipboardList className="w-5 h-5" />
                Детальный разбор всех ответов
              </button>
              
              <button
                onClick={reset}
                className="w-full bg-gray-600 text-white py-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2"
              >
                <RotateCcw className="w-5 h-5" />
                Пройти заново
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Основной интерфейс теста
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-4">
      <div className="max-w-3xl mx-auto">
        {/* Хедер с прогрессом */}
        <div className="bg-white rounded-t-2xl shadow-lg p-6">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="text-sm font-medium text-gray-600">
                {mode === 'training' ? '🎯 Тренировка' : '📝 Экзамен'}
              </h2>
              <p className="text-2xl font-bold text-gray-900">
                Вопрос {currentQ + 1} / {QUESTIONS_DATA.length}
              </p>
            </div>
            <div className="flex gap-2">
              <button
                onClick={() => setShowReview(true)}
                className="text-purple-600 hover:text-purple-700 transition-colors p-2"
                title="Разбор пройденных"
              >
                <ClipboardList className="w-6 h-6" />
              </button>
              <button
                onClick={saveProgress}
                className="text-blue-600 hover:text-blue-700 transition-colors p-2"
                title="Сохранить прогресс"
              >
                <Save className="w-6 h-6" />
              </button>
              <button
                onClick={reset}
                className="text-gray-500 hover:text-gray-700 transition-colors p-2"
                title="Начать заново"
              >
                <RotateCcw className="w-6 h-6" />
              </button>
            </div>
          </div>

          {/* Прогресс-бар */}
          <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
            <div 
              className="bg-gradient-to-r from-purple-500 to-indigo-600 h-full transition-all duration-300"
              style={{ width: `${((currentQ + 1) / QUESTIONS_DATA.length) * 100}%` }}
            />
          </div>

          {/* Статистика */}
          <div className="grid grid-cols-4 gap-3 mt-4">
            <div className="bg-blue-50 p-3 rounded-lg text-center">
              <p className="text-xs text-gray-600">Отвечено</p>
              <p className="text-xl font-bold text-blue-600">{stats.answered}</p>
            </div>
            <div className="bg-green-50 p-3 rounded-lg text-center">
              <p className="text-xs text-gray-600">Правильно</p>
              <p className="text-xl font-bold text-green-600">
                {mode === 'training' ? stats.correct : '?'}
              </p>
            </div>
            <div className="bg-orange-50 p-3 rounded-lg text-center">
              <p className="text-xs text-gray-600">Пропущено</p>
              <p className="text-xl font-bold text-orange-600">{stats.skippedCount}</p>
            </div>
            <div className="bg-purple-50 p-3 rounded-lg text-center">
              <p className="text-xs text-gray-600">Осталось</p>
              <p className="text-xl font-bold text-purple-600">
                {QUESTIONS_DATA.length - stats.answered - stats.skippedCount}
              </p>
            </div>
          </div>
        </div>

        {/* Вопрос и ответы */}
        <div className="bg-white shadow-lg p-6 mb-4">
          {isSkipped && (
            <div className="mb-4 p-3 bg-orange-50 border-l-4 border-orange-500 rounded">
              <p className="text-sm text-orange-800">⏭️ Вопрос был пропущен ранее</p>
            </div>
          )}
          
          <h3 className="text-xl font-bold text-gray-900 mb-6">
            {question.question}
          </h3>

          <div className="space-y-3">
            {displayAnswers.map((answer, idx) => {
              const isSelected = userAnswer === answer.text;
              const isCorrectAnswer = answer.correct;
              
              let bgClass = 'bg-gray-50 border-2 border-gray-200 hover:border-purple-400';
              
              if (showResult && mode === 'training') {
                if (isSelected && isCorrectAnswer) {
                  bgClass = 'bg-green-100 border-2 border-green-500';
                } else if (isSelected && !isCorrectAnswer) {
                  bgClass = 'bg-red-100 border-2 border-red-500';
                } else if (isCorrectAnswer) {
                  bgClass = 'bg-green-50 border-2 border-green-300';
                }
              } else if (isSelected) {
                bgClass = 'bg-purple-100 border-2 border-purple-500';
              }

              return (
                <button
                  key={idx}
                  onClick={() => !showResult && handleAnswer(answer.text)}
                  disabled={showResult && mode === 'training'}
                  className={`w-full text-left p-4 rounded-lg transition-all ${bgClass} ${
                    showResult && mode === 'training' ? 'cursor-not-allowed' : 'cursor-pointer'
                  }`}
                >
                  <div className="flex items-center gap-3">
                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                      isSelected ? 'bg-purple-600 border-purple-600' : 'border-gray-300'
                    }`}>
                      {isSelected && <div className="w-3 h-3 bg-white rounded-full" />}
                    </div>
                    <span className="flex-1 font-medium text-gray-800">{answer.text}</span>
                    {showResult && mode === 'training' && isCorrectAnswer && (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    )}
                    {showResult && mode === 'training' && isSelected && !isCorrectAnswer && (
                      <XCircle className="w-5 h-5 text-red-600" />
                    )}
                  </div>
                </button>
              );
            })}
          </div>

          {/* Пояснение */}
          {showResult && mode === 'training' && (
            <div className={`mt-6 p-4 rounded-lg ${isCorrect ? 'bg-green-50 border-l-4 border-green-500' : 'bg-orange-50 border-l-4 border-orange-500'}`}>
              <div className="flex items-start gap-3">
                {isCorrect ? (
                  <CheckCircle className="w-6 h-6 text-green-600 flex-shrink-0 mt-1" />
                ) : (
                  <AlertCircle className="w-6 h-6 text-orange-600 flex-shrink-0 mt-1" />
                )}
                <div>
                  <p className="font-bold text-gray-900 mb-2">
                    {isCorrect ? '✓ Правильно!' : '✗ Неверно'}
                  </p>
                  <p className="text-sm text-gray-700 whitespace-pre-line">
                    {getExplanation(question, userAnswer, isCorrect)}
                  </p>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Навигация */}
        <div className="bg-white rounded-b-2xl shadow-lg p-4">
          <div className="flex gap-3">
            <button
              onClick={prevQuestion}
              disabled={currentQ === 0}
              className="flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              <ChevronLeft className="w-5 h-5" />
              Назад
            </button>

            {!userAnswer && !showResult && (
              <button
                onClick={handleSkip}
                className="flex items-center gap-2 px-6 py-3 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors"
              >
                <SkipForward className="w-5 h-5" />
                Пропустить
              </button>
            )}

            <button
              onClick={nextQuestion}
              disabled={!userAnswer && !isSkipped}
              className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
            >
              {currentQ === QUESTIONS_DATA.length - 1 ? (
                mode === 'exam' ? (
                  <>Завершить экзамен <Trophy className="w-5 h-5" /></>
                ) : (
                  <>Последний вопрос <ChevronRight className="w-5 h-5" /></>
                )
              ) : (
                <>Следующий <ChevronRight className="w-5 h-5" /></>
              )}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
